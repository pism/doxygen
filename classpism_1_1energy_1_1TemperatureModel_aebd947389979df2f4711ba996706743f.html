<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PISM, A Parallel Ice Sheet Model: pism::energy::TemperatureModel::update_impl</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="browser.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PISM, A Parallel Ice Sheet Model
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacepism.html">pism</a></li><li class="navelem"><a class="el" href="namespacepism_1_1energy.html">energy</a></li><li class="navelem"><a class="el" href="classpism_1_1energy_1_1TemperatureModel.html">TemperatureModel</a></li>  </ul>
</div>
</div><!-- top -->
<div class="contents">
<table cellspacing="0" cellpadding="0" border="0">
  <tr>
   <td valign="top">
      <div class="navtab">
        <table>
          <tr><td class="navtab"><a class="navtab" href="classpism_1_1energy_1_1TemperatureModel_a13099e0308ca85bad275eca591b1a22c.html#a13099e0308ca85bad275eca591b1a22c">bootstrap_impl</a></td></tr>
          <tr><td class="navtab"><a class="navtab" href="classpism_1_1energy_1_1TemperatureModel_ae4226ce33dc6dece2a96583af78d8777.html#ae4226ce33dc6dece2a96583af78d8777">column_drainage</a></td></tr>
          <tr><td class="navtab"><a class="navtab" href="classpism_1_1energy_1_1TemperatureModel_a7f9edd772895aa7f00f4689fdac5b413.html#a7f9edd772895aa7f00f4689fdac5b413">define_model_state_impl</a></td></tr>
          <tr><td class="navtab"><a class="navtab" href="classpism_1_1energy_1_1TemperatureModel_a262b0dd1d20888ec43f990ee7a81a796.html#a262b0dd1d20888ec43f990ee7a81a796">initialize_impl</a></td></tr>
          <tr><td class="navtab"><a class="navtab" href="classpism_1_1energy_1_1TemperatureModel_ad55191fd094b74406c30734dc8fa5343.html#ad55191fd094b74406c30734dc8fa5343">m_ice_temperature</a></td></tr>
          <tr><td class="navtab"><a class="navtab" href="classpism_1_1energy_1_1TemperatureModel_ab6d3c9f094d59d4bd2479e61fce0909a.html#ab6d3c9f094d59d4bd2479e61fce0909a">restart_impl</a></td></tr>
          <tr><td class="navtab"><a class="navtab" href="classpism_1_1energy_1_1TemperatureModel_ada85171f0f20e5ff318e6ea1d8613804.html#ada85171f0f20e5ff318e6ea1d8613804">temperature</a></td></tr>
          <tr><td class="navtab"><a class="navtab" href="classpism_1_1energy_1_1TemperatureModel_a4ae31f0a2e49bfeb4307bbf58355095b.html#a4ae31f0a2e49bfeb4307bbf58355095b">TemperatureModel</a></td></tr>
          <tr><td class="navtabHL"><a class="navtab" href="classpism_1_1energy_1_1TemperatureModel_aebd947389979df2f4711ba996706743f.html#aebd947389979df2f4711ba996706743f">update_impl</a></td></tr>
          <tr><td class="navtab"><a class="navtab" href="classpism_1_1energy_1_1TemperatureModel_ac1de468c17185324adc4864e021f9370.html#ac1de468c17185324adc4864e021f9370">update_impl</a></td></tr>
          <tr><td class="navtab"><a class="navtab" href="classpism_1_1energy_1_1TemperatureModel_a079bc2e7daad93e1be3ec1f06f6813b4.html#a079bc2e7daad93e1be3ec1f06f6813b4">write_model_state_impl</a></td></tr>
        </table>
      </div>
   </td>
   <td valign="top" class="mempage">
<a id="aebd947389979df2f4711ba996706743f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aebd947389979df2f4711ba996706743f">&#9670;&nbsp;</a></span>update_impl() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void pism::energy::TemperatureModel::update_impl </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classpism_1_1energy_1_1Inputs.html">Inputs</a> &amp;&#160;</td>
          <td class="paramname"><em>inputs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Takes a semi-implicit time-step for the temperature equation. </p>
<p>This method should be kept because it is worth having alternative physics, and so that older results can be reproduced. In particular, this method is documented by papers [<a class="el" href="references.html#BBL">BBL</a>,<a class="el" href="references.html#BBssasliding">BBssasliding</a>]. The new browser page bombproofenth essentially documents the cold-ice-BOMBPROOF method here, but the newer enthalpy-based method is slightly different and (we hope) a superior implementation of the conservation of energy principle.</p>
<p>The conservation of energy equation written in terms of temperature is </p><p class="formulaDsp">
\[ \rho c_p(T) \frac{dT}{dt} = k \frac{\partial^2 T}{\partial z^2} + \Sigma,\]
</p>
<p> where \(T(t,x,y,z)\) is the temperature of the ice. This equation is the shallow approximation of the full 3<a class="el" href="classD.html">D</a> conservation of energy. Note \(dT/dt\) stands for the material derivative, so advection is included. Here \(\rho\) is the density of ice, \(c_p\) is its specific heat, and \(k\) is its conductivity. Also \(\Sigma\) is the volume strain heating (with SI units of \(J/(\text{s} \text{m}^3) = \text{W}\,\text{m}^{-3}\)).</p>
<p>We handle horizontal advection explicitly by first-order upwinding. We handle vertical advection implicitly by centered differencing when possible, and retreat to implicit first-order upwinding when necessary. There is a CFL condition for the horizontal explicit upwinding [<a class="el" href="references.html#MortonMayers">MortonMayers</a>]. We report any CFL violations, but they are designed to not occur.</p>
<p>The vertical conduction term is always handled implicitly (i.e. by backward Euler).</p>
<p>We work from the bottom of the column upward in building the system to solve (in the semi-implicit time-stepping scheme). The excess energy above pressure melting is converted to melt-water, and that a fraction of this melt water is transported to the ice base according to the scheme in excessToFromBasalMeltLayer().</p>
<p>The method uses equally-spaced calculation but the <a class="el" href="classpism_1_1columnSystemCtx.html" title="Base class for tridiagonal systems in the ice.">columnSystemCtx</a> methods coarse_to_fine(), fine_to_coarse() interpolate back-and-forth from this equally-spaced computational grid to the (usually) non-equally spaced storage grid.</p>
<p>An instance of <a class="el" href="classpism_1_1energy_1_1tempSystemCtx.html" title="Tridiagonal linear system for vertical column of temperature-based conservation of energy problem.">tempSystemCtx</a> is used to solve the tridiagonal system set-up here.</p>
<p>In this procedure two scalar fields are modified: basal_melt_rate and m_work. But basal_melt_rate will never need to communicate ghosted values (horizontal stencil neighbors). The ghosted values for m_ice_temperature are updated from the values in m_work in the communication done by energy_step().</p>
<p>The (older) scheme cold-ice-BOMBPROOF, implemented here, is very reliable, but there is still an extreme and rare fjord situation which causes trouble. For example, it occurs in one column of ice in one fjord perhaps only once in a 200ka simulation of the whole sheet, in my (ELB) experience modeling the Greenland ice sheet. It causes the discretized advection bulge to give temperatures below that of the coldest ice anywhere, a continuum impossibility. So as a final protection there is a "bulge limiter" which sets the temperature to the surface temperature of the column minus the bulge maximum (15 K) if it is below that level. The number of times this occurs is reported as a "BPbulge" percentage. </p>

<p>Implements <a class="el" href="classpism_1_1energy_1_1EnergyModel_ac1de468c17185324adc4864e021f9370.html#ac1de468c17185324adc4864e021f9370">pism::energy::EnergyModel</a>.</p>

<p class="definition">Definition at line <a class="el" href="TemperatureModel_8cc_source.html#l00166">166</a> of file <a class="el" href="TemperatureModel_8cc_source.html">TemperatureModel.cc</a>.</p>

<p class="reference">References <a class="el" href="IceModelVec__inline_8hh_source.html#l00081">pism::IceModelVec2Int::as_int()</a>, <a class="el" href="EnergyModel_8hh_source.html#l00043">pism::energy::Inputs::basal_frictional_heating</a>, <a class="el" href="EnergyModel_8hh_source.html#l00044">pism::energy::Inputs::basal_heat_flux</a>, <a class="el" href="EnergyModel_8hh_source.html#l00068">pism::energy::EnergyModelStats::bulge_counter</a>, <a class="el" href="EnergyModel_8hh_source.html#l00042">pism::energy::Inputs::cell_type</a>, <a class="el" href="error__handling_8cc_source.html#l00201">pism::ParallelSection::check()</a>, <a class="el" href="EnergyModel_8cc_source.html#l00062">pism::energy::Inputs::check()</a>, <a class="el" href="classpism_1_1energy_1_1TemperatureModel_ae4226ce33dc6dece2a96583af78d8777.html#ae4226ce33dc6dece2a96583af78d8777">column_drainage()</a>, <a class="el" href="energy_2utilities_8cc_source.html#l00047">pism::energy::compute_enthalpy_cold()</a>, <a class="el" href="Units_8cc_source.html#l00072">pism::units::convert()</a>, <a class="el" href="iceModelVec3_8cc_source.html#l00222">pism::IceModelVec3::copy_from()</a>, <a class="el" href="ColumnSystem_8cc_source.html#l00278">pism::columnSystemCtx::dz()</a>, <a class="el" href="error__handling_8cc_source.html#l00185">pism::ParallelSection::failed()</a>, <a class="el" href="ColumnSystem_8cc_source.html#l00286">pism::columnSystemCtx::fine_to_coarse()</a>, <a class="el" href="error__handling_8cc_source.html#l00047">pism::RuntimeError::formatted()</a>, <a class="el" href="pism__utilities_8cc_source.html#l00178">pism::GlobalSum()</a>, <a class="el" href="EnergyModel_8hh_source.html#l00045">pism::energy::Inputs::ice_thickness</a>, <a class="el" href="tempSystem_8cc_source.html#l00069">pism::energy::tempSystemCtx::initThisColumn()</a>, <a class="el" href="exactTestP_8cc_source.html#l00045">pism::k</a>, <a class="el" href="ColumnSystem_8cc_source.html#l00274">pism::columnSystemCtx::ks()</a>, <a class="el" href="exactTestL_8cc_source.html#l00040">L</a>, <a class="el" href="tempSystem_8hh_source.html#l00072">pism::energy::tempSystemCtx::lambda()</a>, <a class="el" href="EnergyModel_8hh_source.html#l00070">pism::energy::EnergyModelStats::low_temperature_counter</a>, <a class="el" href="EnergyModel_8hh_source.html#l00141">pism::energy::EnergyModel::m_basal_melt_rate</a>, <a class="el" href="Component_8hh_source.html#l00138">pism::Component::m_config</a>, <a class="el" href="Component_8hh_source.html#l00136">pism::Component::m_grid</a>, <a class="el" href="TemperatureModel_8hh_source.html#l00059">m_ice_temperature</a>, <a class="el" href="Component_8hh_source.html#l00142">pism::Component::m_log</a>, <a class="el" href="EnergyModel_8hh_source.html#l00143">pism::energy::EnergyModel::m_stats</a>, <a class="el" href="Component_8hh_source.html#l00140">pism::Component::m_sys</a>, <a class="el" href="EnergyModel_8hh_source.html#l00140">pism::energy::EnergyModel::m_work</a>, <a class="el" href="EnergyModel_8cc_source.html#l00094">pism::energy::marginal()</a>, <a class="el" href="Logger_8cc_source.html#l00050">pism::Logger::message()</a>, <a class="el" href="IceGrid_8hh_source.html#l00381">pism::PointsWithGhosts::next()</a>, <a class="el" href="Mask_8hh_source.html#l00039">pism::mask::ocean()</a>, <a class="el" href="error__handling_8hh_source.html#l00044">PISM_ERROR_LOCATION</a>, <a class="el" href="EnergyModel_8hh_source.html#l00069">pism::energy::EnergyModelStats::reduced_accuracy_counter</a>, <a class="el" href="tempSystem_8cc_source.html#l00104">pism::energy::tempSystemCtx::setBasalBoundaryValuesThisColumn()</a>, <a class="el" href="tempSystem_8cc_source.html#l00095">pism::energy::tempSystemCtx::setSurfaceBoundaryValuesThisColumn()</a>, <a class="el" href="EnergyModel_8hh_source.html#l00047">pism::energy::Inputs::shelf_base_temp</a>, <a class="el" href="tempSystem_8cc_source.html#l00126">pism::energy::tempSystemCtx::solveThisColumn()</a>, <a class="el" href="EnergyModel_8hh_source.html#l00048">pism::energy::Inputs::surface_temp</a>, <a class="el" href="EnergyModel_8hh_source.html#l00049">pism::energy::Inputs::till_water_thickness</a>, <a class="el" href="EnergyModel_8hh_source.html#l00052">pism::energy::Inputs::u3</a>, <a class="el" href="EnergyModel_8hh_source.html#l00053">pism::energy::Inputs::v3</a>, <a class="el" href="EnergyModel_8hh_source.html#l00051">pism::energy::Inputs::volumetric_heating_rate</a>, <a class="el" href="tempSystem_8hh_source.html#l00076">pism::energy::tempSystemCtx::w()</a>, <a class="el" href="EnergyModel_8hh_source.html#l00054">pism::energy::Inputs::w3</a>, and <a class="el" href="ColumnSystem_8cc_source.html#l00282">pism::columnSystemCtx::z()</a>.</p>

</div>
</div>
    </td>
  </tr>
</table>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
